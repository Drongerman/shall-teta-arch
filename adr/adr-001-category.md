# [ADR.001][Определение категории системы (ACID|BASE|CA|PACELC)]

* Статус: Предложено
* Владелец: asshalunov@mts.ru

## Контекст
Для системы, состоящей из модулей, ответственных за управления данными (мероприятие, доклады, пользователи, расписание, реклама, бонусы), а также модулей отвественных за интерактив (трансляция, чат, уведомления) необходимо определить категорию (ACID|BASE|CA|PACELC) для построения дальнейшей архитектуры

## Варианты решения

### ACID (Atomicity, Consistency, Isolation, Durability)
* **Плюсы**
  * Гарантирует надежность и целостность данных.
  * Обеспечивает консистентность данных.
  * Подходит для приложений с высокой нагрузкой на запись данных.
* **Минусы**
  * Может привести к снижению производительности в случае большого количества одновременных записей.
  * Не подходит для приложений с высокой нагрузкой на чтение данных.

### BASE (Basically Available, Soft State, Eventually Consistent)
* **Плюсы**
  * Обеспечивает высокую доступность и производительность
  * Подходит для приложений с высокой нагрузкой на чтение данных.
* **Минусы**
  * Риски потери данных в случае сбоев системы.
  * Не гарантирует полной консистентности данных.

### CA (Consistency, Availability)
* **Плюсы**
  * Гарантирует надежность и целостность данных.
  * Обеспечивает консистентность данных.
  * Подходит для приложений с высокой нагрузкой на запись данных.
* **Минусы**
  * При разделении возможность взаимодействовать с системой может быть ограничена
  * Не подходит для приложений с высокой нагрузкой на чтение данных.

### PA/EL (IF P THEN A ELSE L)
* **Плюсы**
  * Обеспечивает высокую доступность и производительность.
  * Подходит для приложений с высокой нагрузкой на чтение данных.
  * Учитывает географическое размещение узлов системы.
* **Минусы**
  * Не гарантирует полной консистентности данных.
  * Риски потери данных в случае сбоев системы.
  * Может привести к снижению производительности в случае большого количества одновременных записей.

## Решение
Для подсистемы управления данными - ниболее частая операция - создание (новый пользователь, новая версии доклада, новая рецензия, новая реклама), но количество таких запросов пропорционально небольшое и будет осуществляться до конференции (до пиковой нагрузки)

Для подсистем интеракцива ниболее частая операция - также создание (новое уведомление, новое посещение доклада, новое сообщение в чате, новый отзыв, новая транзакция бонуса, новое обращение в поддержку)

Высокая доступность на чтение потребуется во время проведения конференции, при этом ключевые данные (пользователи, автор, доклады, расписание) будут сохранены заранее, до конференции, следовательно можно практичеси гарантировать успешное распределении всей информации по узлам, без опасения несогласованности в моменте проведения конференции (CAU 10000). 

Есть требование независимого гео-распределения данных, поскольку доступ ожидается со всей территории РФ, значит будет распределение на несколько датацентров в рамках CDN. 

Мастер данные пользователей будут храниться в рамках наиболее близкого узла с репликацией в остальные. 

Наибольшая нагрузка во время проведения конференций ожидается на создание и чтение данных. 

Самые часто создаваемые данные (сообщения в чат, сформированное уведомление) можно не записывать в хранилище, оперировать только на уровне брокеров.

Пользователям будут важны доступность и скорость отклика платформы, даже при временной несогласованности отдельных данных (включая пакеты трансляции).

Итог:
Для мы используем категорию PA/EL (при разделении высокая доступность, иначе - скорость).

## Последствия
Риск отказа одного из узлов до момента репликации - нагрузка не супер высокая, риск низкий, некритичный

В моментах высокой нагрузки может появится несогласованность данных - риск низкий, некритичный, временный

Пользователь может сохранить данные в одном узле, и случайно попасть на другой узел, до репликация - риск низкий, некритичный, временный

Пользователи чата могут невовремя увидеть комментарии других пользователей, вследствии чего задать вопрос повторно - при высокой нагрузке риск высокий, но некритичный.

Риск полной потери данных - риск низкий, некритичный, в случае утери информации по бонусам - данные можно будет восстановить по событиям из Event Bus

